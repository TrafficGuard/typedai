<div class="flex flex-col flex-auto w-full p-4 sm:p-4">
    <!-- Header -->
    <div class="flex items-center justify-between mb-4 mx-3">
        <!-- Title -->
        <h1 class="text-3xl font-medium tracking-tight leading-none">Vibe Sessions</h1>
        <!-- Actions -->
        <div class="flex shrink-0 items-center">
            <!-- New Button -->
            <button
                    class="ml-4"
                    mat-flat-button
                    [color]="'primary'"
                    (click)="navigateToCreateVibeSession()"
            >
                <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                <span class="ml-2 mr-1">New</span>
            </button>
            <!-- Refresh Button -->
            <button
                    class="ml-4"
                    mat-flat-button
                    [matTooltip]="'Refresh List'"
                    (click)="refreshVibeSessions()"
                    [disabled]="isLoading()"
            >
                <mat-icon [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="overflow-auto bg-card rounded-lg shadow">
        @if (isLoading()) {
            <!-- Loading State -->
            <div class="p-8 text-center text-xl font-medium tracking-tight text-secondary sm:p-16">
                Loading Vibe sessions...
            </div>
        } @else {
            <!-- Data Loaded or No Data State -->
            @if (sessions() && sessions()!.length > 0) {
                <div class="mat-elevation-z0">
                    <table mat-table [dataSource]="sessions()" class="w-full" [trackBy]="trackBySessionId">

                        <!-- Title Column -->
                        <ng-container matColumnDef="title">
                            <th mat-header-cell *matHeaderCellDef>Title</th>
                            <td mat-cell *matCellDef="let session">
                                <a class="hover:text-primary" [routerLink]="['/vibes', session.id]">
                                    {{session.title}}
                                </a>
                            </td>
                        </ng-container>

                        <!-- Status Column -->
                        <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef>Status</th>
                            <td mat-cell *matCellDef="let session">{{session.status}}</td>
                        </ng-container>

                        <!-- Repository Column -->
                        <ng-container matColumnDef="repositoryName">
                            <th mat-header-cell *matHeaderCellDef>Repository</th>
                            <td mat-cell *matCellDef="let session">{{session.repositoryName}}</td>
                        </ng-container>

                        <!-- Last Modified Column -->
                        <ng-container matColumnDef="lastModified">
                            <th mat-header-cell *matHeaderCellDef>Last Modified</th>
                            <td mat-cell *matCellDef="let session">{{session.lastModified | date:'medium'}}</td>
                        </ng-container>
                        
                        <!-- Actions Column -->
                        <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef></th>
                            <td mat-cell *matCellDef="let session" class="text-right">
                                <button mat-icon-button [matTooltip]="'View Details'" [routerLink]="['/vibes', session.id]">
                                    <mat-icon [svgIcon]="'heroicons_outline:eye'"></mat-icon>
                                </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="['title', 'status', 'repositoryName', 'lastModified', 'actions']"></tr>
                        <tr mat-row *matRowDef="let row; columns: ['title', 'status', 'repositoryName', 'lastModified', 'actions'];" class="hover:bg-gray-50 dark:hover:bg-gray-700"></tr>
                    </table>
                </div>
            } @else {
                <!-- No Sessions State -->
                <div class="p-8 text-center text-xl font-medium tracking-tight sm:p-16">
                    <div class="mb-1">No Vibe coding sessions found.</div>
                    <button
                            class="mt-4"
                            mat-flat-button
                            [color]="'primary'"
                            (click)="navigateToCreateVibeSession()"
                    >
                        <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                        <span class="ml-2 mr-1">Create New Session</span>
                    </button>
                </div>
            }
        }
    </div>
</div>
