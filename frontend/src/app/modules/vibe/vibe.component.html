<div class="flex flex-col flex-auto w-full p-6 sm:p-8">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row items-start justify-between mb-6">
        <div class="text-4xl font-extrabold tracking-tight leading-none">Vibe Session Details</div>
        <!-- Add actions like Edit/Delete later if needed -->
        <!-- <div class="mt-4 sm:mt-0 sm:ml-4">
            <button mat-flat-button [color]="'primary'">
                <mat-icon svgIcon="heroicons_solid:pencil-alt"></mat-icon>
                <span class="ml-2">Edit</span>
            </button>
        </div> -->
    </div>

    <!-- Session Details Card -->
    <ng-container *ngIf="session$ | async as session; else loadingOrError">
        <mat-card class="w-full">
            <mat-card-header>
                <mat-card-title>{{ session.title }}</mat-card-title>
                <mat-card-subtitle>ID: {{ session.id }} | Status: {{ session.status | titlecase }}</mat-card-subtitle>
            </mat-card-header>

            <!-- Status specific messages -->
             <div *ngIf="session.status === 'initializing'" class="p-4 m-4 border rounded bg-blue-50 border-blue-200 text-blue-700">
                <div class="flex items-center">
                    <mat-icon class="mr-2" svgIcon="heroicons_outline:information-circle"></mat-icon>
                    <span>Initializing session, cloning repository and setting up workspace...</span>
                </div>
                <mat-progress-bar mode="indeterminate" class="mt-2"></mat-progress-bar>
            </div>
             <div *ngIf="session.status === 'selecting_files'" class="p-4 m-4 border rounded bg-purple-50 border-purple-200 text-purple-700">
                 <div class="flex items-center">
                    <mat-icon class="mr-2" svgIcon="heroicons_outline:document-search"></mat-icon>
                    <span>Analyzing instructions and selecting relevant files...</span>
                 </div>
                <mat-progress-bar mode="indeterminate" class="mt-2"></mat-progress-bar>
            </div>

            <mat-card-content class="mt-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div>
                        <div class="font-semibold">Instructions:</div>
                        <p class="text-secondary whitespace-pre-wrap">{{ session.instructions }}</p>
                    </div>
                    <div>
                        <div class="font-semibold">Repository:</div>
                        <p class="text-secondary">
                            Source: {{ session.repositorySource | titlecase }} <br>
                            Identifier: {{ session.repositoryId }} <br>
                            <ng-container *ngIf="session.repositoryName">
                                Name: {{ session.repositoryName }} <br>
                            </ng-container>
                            Branch: {{ session.branch }} <br>
                            <ng-container *ngIf="session.newBranchName">
                                New Branch: {{ session.newBranchName }} <br>
                            </ng-container>
                            Shared Repo: {{ session.useSharedRepos ? 'Yes' : 'No' }}
                        </p>
                    </div>
                    <div>
                        <div class="font-semibold">Created At:</div>
                        <!-- Assuming createdAt is a Firestore Timestamp or Date object -->
                        <p class="text-secondary">{{ session.createdAt?.toDate ? session.createdAt.toDate() : session.createdAt | date:'medium' }}</p>
                    </div>
                    <div>
                        <div class="font-semibold">Last Updated:</div>
                        <p class="text-secondary">{{ session.updatedAt?.toDate ? session.updatedAt.toDate() : session.updatedAt | date:'medium' }}</p>
                    </div>
                    <div *ngIf="session.error" class="sm:col-span-2">
                        <div class="font-semibold text-red-600">Error:</div>
                        <p class="text-red-500 whitespace-pre-wrap">{{ session.error }}</p>
                    </div>
                     <div *ngIf="session.fileSelection?.length" class="sm:col-span-2">
                        <div class="font-semibold mb-2">Selected Files:</div>
                        <!-- Use mat-list for file display -->
                        <mat-list dense>
                            <mat-list-item *ngFor="let file of session.fileSelection" class="h-auto! py-1">
                                <mat-icon matListItemIcon *ngIf="file.readOnly" class="mr-2 text-gray-500" matTooltip="Read Only">lock</mat-icon>
                                <span class="text-secondary break-all">{{ file.filePath }}</span>
                                <!-- Add file.reason display here if needed in the future -->
                            </mat-list-item>
                        </mat-list>
                    </div>
                    <div *ngIf="session.designAnswer" class="sm:col-span-2">
                        <div class="font-semibold">Design Proposal:</div>
                        <p class="text-secondary whitespace-pre-wrap">{{ session.designAnswer }}</p>
                    </div>
                </div>
            </mat-card-content>
            <!-- Add card actions if needed -->
            <!-- <mat-card-actions align="end">
                <button mat-button>Action</button>
            </mat-card-actions> -->
        </mat-card>
    </ng-container>

    <!-- Loading/Error Template -->
    <ng-template #loadingOrError>
        <!-- Check if there was an error fetching (e.g., using catchError in the observable pipe), otherwise show loading -->
        <!-- Basic loading indicator -->
        <div class="flex justify-center items-center h-64">
             <!-- Consider adding error handling display here if session$ errors out -->
            <mat-progress-bar mode="indeterminate" class="w-64"></mat-progress-bar>
            <span class="ml-4 text-secondary">Loading session details...</span>
        </div>
    </ng-template>
</div>
